<div class="app-component" data-component="profile">
<div class="profile-container">
  <div class="profile-header">
    <h1>ğŸ‘¤ User Profile</h1>
    <p>Manage your account settings and API credentials</p>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="icon">âš ï¸</i>
    {{ error }}
  </div>

  <div *ngIf="success" class="alert alert-success">
    <i class="icon">âœ…</i>
    {{ success }}
  </div>

  <!-- Profile Stats -->
  <div *ngIf="profileData" class="profile-stats">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-number">{{ profileData.statistics.totalAnalyses }}</div>
        <div class="stat-label">Total Analyses</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“š</div>
      <div class="stat-content">
        <div class="stat-number">{{ profileData.statistics.totalWordLibraries || 0 }}</div>
        <div class="stat-label">Training Data</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ”‘</div>
      <div class="stat-content">
        <div class="stat-status" [style.color]="getCredentialStatusColor()">
          {{ getCredentialStatus() }}
        </div>
        <div class="stat-label">API Status</div>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'profile'"
      (click)="setActiveTab('profile')">
      ğŸ‘¤ Profile Info
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'password'"
      (click)="setActiveTab('password')">
      ğŸ”’ Change Password
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'api-credentials'"
      (click)="setActiveTab('api-credentials')">
      ğŸ”‘ API Credentials
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'sessions'"
      (click)="setActiveTab('sessions')">
      ğŸ–¥ï¸ Active Sessions
    </button>
  </div>

  <!-- Profile Information Tab -->
  <div *ngIf="activeTab === 'profile'" class="tab-content">
    <div class="form-card">
      <h3>Profile Information</h3>
      <form (ngSubmit)="updateProfile()" #profileFormRef="ngForm">
        <div class="form-group">
          <label for="username">Username</label>
          <input 
            type="text" 
            id="username" 
            name="username"
            [(ngModel)]="profileForm.username" 
            required 
            class="form-control">
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email"
            [(ngModel)]="profileForm.email" 
            required 
            class="form-control">
        </div>

        <div *ngIf="profileData" class="form-info">
          <p><strong>Role:</strong> {{ profileData.user.role }}</p>
          <p><strong>Member since:</strong> {{ formatDate(profileData.user.created_at) }}</p>
          <p><strong>Last updated:</strong> {{ formatDate(profileData.user.updated_at) }}</p>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="loading || !profileFormRef.valid">
          <span *ngIf="loading">â³ Updating...</span>
          <span *ngIf="!loading">ğŸ’¾ Update Profile</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Change Password Tab -->
  <div *ngIf="activeTab === 'password'" class="tab-content">
    <div class="form-card">
      <h3>Change Password</h3>
      <form (ngSubmit)="changePassword()" #passwordFormRef="ngForm">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input 
            type="password" 
            id="currentPassword" 
            name="currentPassword"
            [(ngModel)]="passwordForm.currentPassword" 
            required 
            class="form-control">
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input 
            type="password" 
            id="newPassword" 
            name="newPassword"
            [(ngModel)]="passwordForm.newPassword" 
            required 
            minlength="6"
            class="form-control">
          <small class="form-text">Password must be at least 6 characters long</small>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input 
            type="password" 
            id="confirmPassword" 
            name="confirmPassword"
            [(ngModel)]="passwordForm.confirmPassword" 
            required 
            class="form-control">
        </div>

        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="loading || !passwordFormRef.valid">
          <span *ngIf="loading">â³ Changing...</span>
          <span *ngIf="!loading">ğŸ”’ Change Password</span>
        </button>
      </form>
    </div>
  </div>

  <!-- API Credentials Tab -->
  <div *ngIf="activeTab === 'api-credentials'" class="tab-content">
    <div class="form-card">
      <h3>API Credentials</h3>
      
      <!-- Current Credentials Status -->
      <div *ngIf="credentialsInfo" class="credentials-status">
        <div class="status-item">
          <strong>Status:</strong> 
          <span [style.color]="getCredentialStatusColor()">{{ getCredentialStatus() }}</span>
        </div>
        <div *ngIf="credentialsInfo.configured" class="status-item">
          <strong>Last Updated:</strong> {{ formatDate(credentialsInfo.lastUpdated) }}
        </div>
        <div *ngIf="credentialsInfo.expiresAt" class="status-item">
          <strong>Expires:</strong> 
          <span [class.expired]="credentialsInfo.isExpired">
            {{ formatDate(credentialsInfo.expiresAt) }}
          </span>
        </div>
      </div>

      <!-- Current Masked Credentials Display -->
      <div *ngIf="credentialsInfo?.configured && credentialsInfo?.credentials" class="current-credentials">
        <h4>Current Credentials (Masked)</h4>
        <div class="credential-item" *ngIf="credentialsInfo?.credentials?.bearerToken">
          <strong>Bearer Token:</strong> {{ credentialsInfo?.credentials?.bearerToken }}
        </div>
        <div class="credential-item" *ngIf="credentialsInfo?.credentials?.apiKey">
          <strong>API Key:</strong> {{ credentialsInfo?.credentials?.apiKey }}
        </div>
        <div class="credential-item" *ngIf="credentialsInfo?.credentials?.apiSecret">
          <strong>API Secret:</strong> {{ credentialsInfo?.credentials?.apiSecret }}
        </div>
        <div class="credential-item" *ngIf="credentialsInfo?.credentials?.accessToken">
          <strong>Access Token:</strong> {{ credentialsInfo?.credentials?.accessToken }}
        </div>
        <div class="credential-item" *ngIf="credentialsInfo?.credentials?.accessTokenSecret">
          <strong>Access Token Secret:</strong> {{ credentialsInfo?.credentials?.accessTokenSecret }}
        </div>
      </div>

      <!-- Update Credentials Form -->
      <form (ngSubmit)="updateApiCredentials()" #credentialsFormRef="ngForm">
        <div class="form-section">
          <h4>Basic Credentials</h4>
          <div class="form-group">
            <label for="bearerToken">X/Twitter Bearer Token</label>
            <input 
              type="password" 
              id="bearerToken" 
              name="bearerToken"
              [(ngModel)]="credentialsForm.bearerToken" 
              class="form-control"
              placeholder="Enter your X/Twitter Bearer Token">
            <small class="form-text">Required for basic tweet fetching</small>
          </div>
        </div>

        <div class="form-section">
          <h4>Advanced Credentials (Optional)</h4>
          <div class="form-group">
            <label for="apiKey">API Key</label>
            <input 
              type="text" 
              id="apiKey" 
              name="apiKey"
              [(ngModel)]="credentialsForm.apiKey" 
              class="form-control"
              placeholder="Enter your API Key">
          </div>

          <div class="form-group">
            <label for="apiSecret">API Secret</label>
            <input 
              type="password" 
              id="apiSecret" 
              name="apiSecret"
              [(ngModel)]="credentialsForm.apiSecret" 
              class="form-control"
              placeholder="Enter your API Secret">
          </div>

          <div class="form-group">
            <label for="accessToken">Access Token</label>
            <input 
              type="password" 
              id="accessToken" 
              name="accessToken"
              [(ngModel)]="credentialsForm.accessToken" 
              class="form-control"
              placeholder="Enter your Access Token">
          </div>

          <div class="form-group">
            <label for="accessTokenSecret">Access Token Secret</label>
            <input 
              type="password" 
              id="accessTokenSecret" 
              name="accessTokenSecret"
              [(ngModel)]="credentialsForm.accessTokenSecret" 
              class="form-control"
              placeholder="Enter your Access Token Secret">
          </div>
        </div>

        <div class="form-section">
          <h4>Expiry Settings</h4>
          <div class="form-group">
            <label for="expiresAt">Expiry Date (Optional)</label>
            <input 
              type="datetime-local" 
              id="expiresAt" 
              name="expiresAt"
              [(ngModel)]="credentialsForm.expiresAt" 
              class="form-control">
            <small class="form-text">Set when these credentials should expire</small>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="loading">
            <span *ngIf="loading">â³ Updating...</span>
            <span *ngIf="!loading">ğŸ’¾ Update Credentials</span>
          </button>

          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="clearCredentialsForm()"
            [disabled]="loading">
            ğŸ—‘ï¸ Clear Form
          </button>

          <button 
            type="button" 
            class="btn btn-danger"
            (click)="deleteApiCredentials()"
            [disabled]="loading || !credentialsInfo?.configured"
            *ngIf="credentialsInfo?.configured">
            <span *ngIf="loading">â³ Deleting...</span>
            <span *ngIf="!loading">ğŸ—‘ï¸ Delete Credentials</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Active Sessions Tab -->
  <div *ngIf="activeTab === 'sessions'" class="tab-content">
    <div class="form-card">
      <h3>ğŸ–¥ï¸ Active Sessions</h3>
      <p>Manage your active login sessions for security</p>

      <div *ngIf="sessionsLoading" class="loading-state">
        <div class="spinner"></div>
        <span>Loading sessions...</span>
      </div>

      <div *ngIf="!sessionsLoading && userSessions.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ”</div>
        <h4>No Active Sessions</h4>
        <p>You currently have no active sessions</p>
      </div>

      <div *ngIf="!sessionsLoading && userSessions.length > 0" class="sessions-list">
        <div class="sessions-header">
          <div class="sessions-info">
            <span class="sessions-count">{{ userSessions.length }} active session(s)</span>
            <button 
              type="button" 
              class="btn btn-outline btn-sm"
              (click)="refreshSessions()"
              [disabled]="sessionsLoading">
              ğŸ”„ Refresh
            </button>
          </div>
          <button 
            type="button" 
            class="btn btn-warning btn-sm"
            (click)="revokeOtherSessions()"
            [disabled]="sessionsLoading || userSessions.length <= 1">
            ğŸšª End Other Sessions
          </button>
        </div>

        <div class="session-item" *ngFor="let session of userSessions; trackBy: trackSession">
          <div class="session-info">
            <div class="session-status">
              <span class="status-indicator" [class]="'status-' + session.status"></span>
              <span class="status-text">{{ session.status | titlecase }}</span>
            </div>
            <div class="session-details">
              <div class="session-created">
                <strong>Created:</strong> {{ formatDate(session.created_at) }}
              </div>
              <div class="session-expires">
                <strong>Expires:</strong> {{ formatDate(session.expires_at) }}
              </div>
            </div>
          </div>
          <div class="session-actions">
            <button 
              type="button" 
              class="btn btn-danger btn-sm"
              (click)="revokeSession(session.id)"
              [disabled]="sessionsLoading">
              ğŸ—‘ï¸ Revoke
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>